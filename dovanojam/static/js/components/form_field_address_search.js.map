{"version":3,"sources":["form_field_address_search.es6"],"names":[],"mappings":"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","file":"form_field_address_search.js","sourcesContent":["class SearchField {\n\n    constructor (config = {}) {\n        this._config = {\n            map: {\n                id: \"map\",\n                defaulZoom: 14,\n                config: {\n                    zoom: 13,\n                    scrollWheel: false,\n                    mapTypeId: google.maps.MapTypeId.ROADMAP,\n                    center: { lat: 47.658236, lng: -2.7608470000000125 }\n                }\n            },\n            marker: {\n                position: null,\n                map: null,\n                animation: google.maps.Animation.DROP\n            },\n            autocomplete: {\n                types: ['geocode']\n            },\n            search_form: {\n                address_field_id: 'city_search_field',\n                default_address: 'Vannes, France',\n                lat_field_id: 'lat_field',\n                lng_field_id: 'lng_field'\n            }\n        }\n        this.default_config = config\n\n        this.addressForm = {\n            locality: 'long_name',\n            country: 'long_name'\n        }\n\n        this.initializeElements()\n    }\n\n    get mapElement () {\n        return document.getElementById(this._config.map.id)\n    }\n\n    get searchFieldElement () {\n        return document.getElementById(this._config.search_form.address_field_id)\n    }\n\n    get default_config () {\n        return this._config\n    }\n\n    set default_config (config) {\n        this._config = Object.assign(this._config, config)\n    }\n\n    initializeElements () {\n        this.autocomplete = new google.maps.places.Autocomplete(this.searchFieldElement, this._config.autocomplete)\n\n        this.autocomplete.addListener('place_changed', () => {\n            let place = this.autocomplete.getPlace()\n            this.updateMap(place)\n        })\n\n        this.geocoder = new google.maps.Geocoder()\n        this.infoWindow = new google.maps.InfoWindow\n        this.marker = null\n        this.map = null\n\n        this.geocodeFromAddress(this._config.search_form.default_address, (place) => {\n            if (place) {\n                this.updateMap(place)\n            } else {\n                this.handleLocationError(true)\n            }\n        })\n\n        this.geolocalizeMe()\n    }\n\n    geolocalizeMe () {\n        this.geolocalize((geolocalized) => {\n            if (!geolocalized) {\n                this.handleLocationError(false)\n            } else {\n                this.updateMap(geolocalized)\n                this.fillAddressForm(geolocalized)\n            }\n        })\n    }\n\n    geocodeFromAddress (address = null, cb) {\n        if (!address)\n            address = this._config.search_form.default_address\n\n        this.geocoder.geocode({'address': address}, (results, status) => {\n            if (status === google.maps.GeocoderStatus.OK) {\n                cb(results[0])\n            } else {\n                cb(null);\n            }\n        });\n    }\n\n    geocodeFromLatLng (latlng = null, cb) {\n        if (!latlng)\n            return cb(null)\n\n        this.geocoder.geocode({'location': latlng}, (results, status) => {\n            if (status === google.maps.GeocoderStatus.OK)\n                return cb(results[0])\n\n            return cb(null)\n        })\n    }\n\n    fillAddressForm (place = null) {\n        if (!place)\n            return null\n\n        for (var component in this.addressForm) {\n            document.getElementById(component).value = ''\n        }\n\n        document.getElementById(this._config.search_form.lat_field_id).value = ''\n        document.getElementById(this._config.search_form.lng_field_id).value = ''\n        this.searchFieldElement.value = ''\n\n        for(var i = 0; i < place.address_components.length; i++) {\n            var addressType = place.address_components[i].types[0]\n            if (this.addressForm[addressType]) {\n                var val = place.address_components[i][this.addressForm[addressType]]\n                document.getElementById(addressType).value = val\n            }\n        }\n        this.searchFieldElement.value = place.formatted_address\n        document.getElementById(this._config.search_form.lat_field_id).value = place.geometry.location.lat()\n        document.getElementById(this._config.search_form.lng_field_id).value = place.geometry.location.lng()\n    }\n\n    updateMap (place) {\n        if (!this.map) {\n            this.map = new google.maps.Map(this.mapElement, this._config.map.config)\n        }\n\n        //this.map.setCenter(place.geometry.location)\n        this.map.panTo(place.geometry.location)\n        this.map.setZoom(this._config.map.defaulZoom)\n\n        // Update Search Form with the Address of the place\n        this.fillAddressForm(place)\n\n        // Update Marker ans set info Window\n        this.updateMarker(place)\n        this.infoWindow.setContent(place.formatted_address)\n        this.infoWindow.open(this.map, this.marker)\n    }\n\n    updateMarker (place) {\n        if (!this.marker) {\n            this.marker = new google.maps.Marker(this.marker)\n            this.marker.setMap(this.map)\n        }\n\n        this.marker.setPosition(place.geometry.location)\n        if (place.icon) {\n            this.marker.setIcon({\n                url: place.icon,\n                size: new google.maps.Size(71, 71),\n                origin: new google.maps.Point(0, 0),\n                anchor: new google.maps.Point(34, 34),\n                scaledSize: new google.maps.Size(35, 35)\n            })\n        }\n\n    }\n\n    geolocalize (cb) {\n        if (navigator.geolocation) {\n            navigator.geolocation.getCurrentPosition((position) => {\n                var pos = {\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude\n                }\n\n                this.geocodeFromLatLng(pos, (place) => {\n                    if (!place) {\n                        this.handleLocationError(true, pos)\n                    }\n\n                    cb(place)\n                })\n            }, () => {\n                cb(false)\n            })\n        } else {\n            // Browser doesn't support Geolocation\n            cb(false)\n        }\n    }\n\n    handleLocationError (browserHasGeolocation = false, pos = null) {\n        if (!pos)\n            pos = this.map.getCenter()\n\n        this.infoWindow.setPosition(pos)\n        this.infoWindow.setContent(browserHasGeolocation ?\n            'Error: The Geolocation services has failed' :\n            'Error: Your browser doesn\\'t support geolocation.'\n        )\n    }\n}\n\n(function ($) {\n    'use strict'\n\n    var SearchForm = null\n    google.maps.event.addDomListener(window, 'load', () => {\n        SearchForm = new SearchField()\n        google.maps.event.addListener(SearchForm.infoWindow, 'content_changed', () => {\n            Materialize.updateTextFields()\n        })\n    })\n\n    $(document).ready(function () {\n\n        $('form#create_classified').on('keypress', (event) => {\n            // If Keyboard ENTER beeing pressed\n            if (event.which === 13) {\n                event.preventDefault()\n                return false\n            }\n        })\n\n        $('a.localize-me').on('click tap', function (e) {\n            $('.progress', '#map').show()\n            SearchForm.geolocalizeMe()\n            e.preventDefault()\n            return false\n        });\n    });\n\n})(jQuery);\n"]}