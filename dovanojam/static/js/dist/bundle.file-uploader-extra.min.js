!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","load-image-meta","load-image-exif","canvas-to-blob","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery"),require("blueimp-load-image/js/load-image"),require("blueimp-load-image/js/load-image-meta"),require("blueimp-load-image/js/load-image-exif"),require("blueimp-canvas-to-blob"),require("./jquery.fileupload-process")):e(window.jQuery,window.loadImage)}(function(e,i){"use strict";e.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"}),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(t,n){if(n.disabled)return t;var a=this,r=t.files[t.index],o=e.Deferred();return"number"===e.type(n.maxFileSize)&&r.size>n.maxFileSize||n.fileTypes&&!n.fileTypes.test(r.type)||!i(r,function(e){e.src&&(t.img=e),o.resolveWith(a,[t])},n)?t:o.promise()},resizeImage:function(t,n){if(n.disabled||!t.canvas&&!t.img)return t;n=e.extend({canvas:!0},n);var a,r=this,o=e.Deferred(),s=n.canvas&&t.canvas||t.img,l=function(e){e&&(e.width!==s.width||e.height!==s.height||n.forceResize)&&(t[e.getContext?"canvas":"img"]=e),t.preview=e,o.resolveWith(r,[t])};if(t.exif){if(n.orientation===!0&&(n.orientation=t.exif.get("Orientation")),n.thumbnail&&(a=t.exif.get("Thumbnail")))return i(a,l,n),o.promise();t.orientation?delete n.orientation:t.orientation=n.orientation}return s?(l(i.scale(s,n)),o.promise()):t},saveImage:function(i,t){if(!i.canvas||t.disabled)return i;var n=this,a=i.files[i.index],r=e.Deferred();return i.canvas.toBlob?(i.canvas.toBlob(function(e){e.name||(a.type===e.type?e.name=a.name:a.name&&(e.name=a.name.replace(/\.\w+$/,"."+e.type.substr(6)))),a.type!==e.type&&delete i.imageHead,i.files[i.index]=e,r.resolveWith(n,[i])},t.type||a.type,t.quality),r.promise()):i},loadImageMetaData:function(t,n){if(n.disabled)return t;var a=this,r=e.Deferred();return i.parseMetaData(t.files[t.index],function(i){e.extend(t,i),r.resolveWith(a,[t])},n),r.promise()},saveImageMetaData:function(e,i){if(!(e.imageHead&&e.canvas&&e.canvas.toBlob)||i.disabled)return e;var t=e.files[e.index],n=new Blob([e.imageHead,this._blobSlice.call(t,20)],{type:t.type});return n.name=t.name,e.files[e.index]=n,e},setImage:function(e,i){return e.preview&&!i.disabled&&(e.files[e.index][i.name||"preview"]=e.preview),e},deleteImageReferences:function(e,i){return i.disabled||(delete e.img,delete e.canvas,delete e.preview,delete e.imageHead),e}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload-process"],e):e("object"==typeof exports?require("jquery"):window.jQuery)}(function(e){"use strict";e.blueimp.fileupload.prototype.options.processQueue.push({action:"validate",always:!0,acceptFileTypes:"@",maxFileSize:"@",minFileSize:"@",maxNumberOfFiles:"@",disabled:"@disableValidation"}),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{getNumberOfFiles:e.noop,messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too large",minFileSize:"File is too small"}},processActions:{validate:function(i,t){if(t.disabled)return i;var n,a=e.Deferred(),r=this.options,o=i.files[i.index];return(t.minFileSize||t.maxFileSize)&&(n=o.size),"number"===e.type(t.maxNumberOfFiles)&&(r.getNumberOfFiles()||0)+i.files.length>t.maxNumberOfFiles?o.error=r.i18n("maxNumberOfFiles"):!t.acceptFileTypes||t.acceptFileTypes.test(o.type)||t.acceptFileTypes.test(o.name)?n>t.maxFileSize?o.error=r.i18n("maxFileSize"):"number"===e.type(n)&&n<t.minFileSize?o.error=r.i18n("minFileSize"):delete o.error:o.error=r.i18n("acceptFileTypes"),o.error||i.files.error?(i.files.error=!0,a.rejectWith(this,[i])):a.resolveWith(this,[i]),a.promise()}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):"object"==typeof exports?e(require("jquery"),require("tmpl")):e(window.jQuery,window.tmpl)}(function(e,i){"use strict";e.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{autoUpload:!1,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",messages:{unknownError:"Unknown error"},getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(i){return i.result&&e.isArray(i.result.files)?i.result.files:[]},add:function(i,t){if(i.isDefaultPrevented())return!1;var n=e(this),a=n.data("blueimp-fileupload")||n.data("fileupload"),r=a.options;t.context=a._renderUpload(t.files).data("data",t).addClass("processing"),r.filesContainer[r.prependFiles?"prepend":"append"](t.context),a._forceReflow(t.context),a._transition(t.context),t.process(function(){return n.fileupload("process",t)}).always(function(){t.context.each(function(i){e(this).find(".size").text(a._formatFileSize(t.files[i].size))}).removeClass("processing"),a._renderPreviews(t)}).done(function(){t.context.find(".start").prop("disabled",!1),a._trigger("added",i,t)!==!1&&(r.autoUpload||t.autoUpload)&&t.autoUpload!==!1&&t.submit()}).fail(function(){t.files.error&&t.context.each(function(i){var n=t.files[i].error;n&&e(this).find(".error").text(n)})})},send:function(i,t){if(i.isDefaultPrevented())return!1;var n=e(this).data("blueimp-fileupload")||e(this).data("fileupload");return t.context&&t.dataType&&"iframe"===t.dataType.substr(0,6)&&t.context.find(".progress").addClass(!e.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%"),n._trigger("sent",i,t)},done:function(i,t){if(i.isDefaultPrevented())return!1;var n,a,r=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),o=t.getFilesFromResponse||r.options.getFilesFromResponse,s=o(t);t.context?t.context.each(function(o){var l=s[o]||{error:"Empty file upload result"};a=r._addFinishedDeferreds(),r._transition(e(this)).done(function(){var o=e(this);n=r._renderDownload([l]).replaceAll(o),r._forceReflow(n),r._transition(n).done(function(){t.context=e(this),r._trigger("completed",i,t),r._trigger("finished",i,t),a.resolve()})})}):(n=r._renderDownload(s)[r.options.prependFiles?"prependTo":"appendTo"](r.options.filesContainer),r._forceReflow(n),a=r._addFinishedDeferreds(),r._transition(n).done(function(){t.context=e(this),r._trigger("completed",i,t),r._trigger("finished",i,t),a.resolve()}))},fail:function(i,t){if(i.isDefaultPrevented())return!1;var n,a,r=e(this).data("blueimp-fileupload")||e(this).data("fileupload");t.context?t.context.each(function(o){if("abort"!==t.errorThrown){var s=t.files[o];s.error=s.error||t.errorThrown||t.i18n("unknownError"),a=r._addFinishedDeferreds(),r._transition(e(this)).done(function(){var o=e(this);n=r._renderDownload([s]).replaceAll(o),r._forceReflow(n),r._transition(n).done(function(){t.context=e(this),r._trigger("failed",i,t),r._trigger("finished",i,t),a.resolve()})})}else a=r._addFinishedDeferreds(),r._transition(e(this)).done(function(){e(this).remove(),r._trigger("failed",i,t),r._trigger("finished",i,t),a.resolve()})}):"abort"!==t.errorThrown?(t.context=r._renderUpload(t.files)[r.options.prependFiles?"prependTo":"appendTo"](r.options.filesContainer).data("data",t),r._forceReflow(t.context),a=r._addFinishedDeferreds(),r._transition(t.context).done(function(){t.context=e(this),r._trigger("failed",i,t),r._trigger("finished",i,t),a.resolve()})):(r._trigger("failed",i,t),r._trigger("finished",i,t),r._addFinishedDeferreds().resolve())},progress:function(i,t){if(i.isDefaultPrevented())return!1;var n=Math.floor(t.loaded/t.total*100);t.context&&t.context.each(function(){e(this).find(".progress").attr("aria-valuenow",n).children().first().css("width",n+"%")})},progressall:function(i,t){if(i.isDefaultPrevented())return!1;var n=e(this),a=Math.floor(t.loaded/t.total*100),r=n.find(".fileupload-progress"),o=r.find(".progress-extended");o.length&&o.html((n.data("blueimp-fileupload")||n.data("fileupload"))._renderExtendedProgress(t)),r.find(".progress").attr("aria-valuenow",a).children().first().css("width",a+"%")},start:function(i){if(i.isDefaultPrevented())return!1;var t=e(this).data("blueimp-fileupload")||e(this).data("fileupload");t._resetFinishedDeferreds(),t._transition(e(this).find(".fileupload-progress")).done(function(){t._trigger("started",i)})},stop:function(i){if(i.isDefaultPrevented())return!1;var t=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),n=t._addFinishedDeferreds();e.when.apply(e,t._getFinishedDeferreds()).done(function(){t._trigger("stopped",i)}),t._transition(e(this).find(".fileupload-progress")).done(function(){e(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),e(this).find(".progress-extended").html("&nbsp;"),n.resolve()})},processstart:function(i){return i.isDefaultPrevented()?!1:void e(this).addClass("fileupload-processing")},processstop:function(i){return i.isDefaultPrevented()?!1:void e(this).removeClass("fileupload-processing")},destroy:function(i,t){if(i.isDefaultPrevented())return!1;var n=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),a=function(){n._transition(t.context).done(function(){e(this).remove(),n._trigger("destroyed",i,t)})};t.url?(t.dataType=t.dataType||n.options.dataType,e.ajax(t).done(a).fail(function(){n._trigger("destroyfailed",i,t)})):a()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(i){return i||(i=e.Deferred()),this._finishedUploads.push(i),i},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var i=e(this),t=i.prop("href"),n=i.prop("download"),a="application/octet-stream";i.bind("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[a,n,t].join(":"))}catch(i){}})},_formatFileSize:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" Gbit/s":e>=1e6?(e/1e6).toFixed(2)+" Mbit/s":e>=1e3?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},_formatTime:function(e){var i=new Date(1e3*e),t=Math.floor(e/86400);return t=t?t+"d ":"",t+("0"+i.getUTCHours()).slice(-2)+":"+("0"+i.getUTCMinutes()).slice(-2)+":"+("0"+i.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_renderTemplate:function(i,t){if(!i)return e();var n=i({files:t,formatFileSize:this._formatFileSize,options:this.options});return n instanceof e?n:e(this.options.templatesContainer).html(n).children()},_renderPreviews:function(i){i.context.find(".preview").each(function(t,n){e(n).append(i.files[t].preview)})},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(i){i.preventDefault();var t=e(i.currentTarget),n=t.closest(".template-upload"),a=n.data("data");t.prop("disabled",!0),a&&a.submit&&a.submit()},_cancelHandler:function(i){i.preventDefault();var t=e(i.currentTarget).closest(".template-upload,.template-download"),n=t.data("data")||{};n.context=n.context||t,n.abort?n.abort():(n.errorThrown="abort",this._trigger("fail",i,n))},_deleteHandler:function(i){i.preventDefault();var t=e(i.currentTarget);this._trigger("destroy",i,e.extend({context:t.closest(".template-download"),type:"DELETE"},t.data()))},_forceReflow:function(i){return e.support.transition&&i.length&&i[0].offsetWidth},_transition:function(i){var t=e.Deferred();return e.support.transition&&i.hasClass("fade")&&i.is(":visible")?i.bind(e.support.transition.end,function(n){n.target===i[0]&&(i.unbind(e.support.transition.end),t.resolveWith(i))}).toggleClass("in"):(i.toggleClass("in"),t.resolveWith(i)),t},_initButtonBarEventHandlers:function(){var i=this.element.find(".fileupload-buttonbar"),t=this.options.filesContainer;this._on(i.find(".start"),{click:function(e){e.preventDefault(),t.find(".start").click()}}),this._on(i.find(".cancel"),{click:function(e){e.preventDefault(),t.find(".cancel").click()}}),this._on(i.find(".delete"),{click:function(e){e.preventDefault(),t.find(".toggle:checked").closest(".template-download").find(".delete").click(),i.find(".toggle").prop("checked",!1)}}),this._on(i.find(".toggle"),{change:function(i){t.find(".toggle").prop("checked",e(i.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName")),i&&(e.uploadTemplateId&&(e.uploadTemplate=i(e.uploadTemplateId)),e.downloadTemplateId&&(e.downloadTemplate=i(e.downloadTemplateId)))},_initFilesContainer:function(){var i=this.options;void 0===i.filesContainer?i.filesContainer=this.element.find(".files"):i.filesContainer instanceof e||(i.filesContainer=e(i.filesContainer))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._resetFinishedDeferreds(),e.support.fileInput||this._disableFileInputButton()},enable:function(){var e=!1;this.options.disabled&&(e=!0),this._super(),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})});